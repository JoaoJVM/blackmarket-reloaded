define(["angular"],function(){var e={name:"BR-S",salt:"BRKey",saveInterval:void 0,saveVars:["money","totalMoney","allTimeMoney","level","reputation","totalReputation","allTimeReputation","reputationNeed","actions.progress","actions.owned","actions.rewardMultiplier","actions.totalRewardMultiplier","actions.timeMultiplier","actions.totalTimeMultiplier","actions.currentRep","research.actions.bought","collections.owned","options.before","options.firstTime","options.softReset","options.version","options.started","options.countReset","options.fps","production.invested","production.multipliers","production.totalRewardMultiplier","production.stock","production.prod.cocaineOwned","production.prod.methOwned","production.prod.weedOwned","production.prod.cocainePerSec","production.prod.methPerSec","production.prod.weedPerSec","production.sell.cocaineOwned","production.sell.methOwned","production.sell.weedOwned","production.sell.cocainePerSec","production.sell.methPerSec","production.sell.weedPerSec"],softResetSaveVars:["allTimeMoney","allTimeReputation","reputation","level","collections.owned","options.started","options.firstTime","options.softReset","actions.totalRewardMultiplier","actions.totalTimeMultiplier","actions.totalReputationMultiplier","options.countReset","production.totalRewardMultiplier"],setObjValByPath:function(e,t,o){for(o=o.split("."),i=0;i<o.length-1;i++)e=e[o[i]];e[o[i]]=t},getObjValByPath:function(e,t){var o=t.split(".").reduce(function(e,t){return e[t]},e);return o},save:function(e){var t=new Object;for(i=0;i<this.saveVars.length;i++)t[this.saveVars[i]]=this.getObjValByPath(game,this.saveVars[i]);game.options.init&&localStorage.setItem(this.name+this.salt,JSON.stringify(t)),"user"==e&&notify.pop("success","Game successfully saved!"),"silent"!==e&&log("Game saved.")},checkExists:function(e){return"undefined"==typeof e||null===e?!1:!0},load:function(e){if(null===localStorage.getItem(this.name+this.salt))notify.pop("alert","No save found!");else{var t=JSON.parse(localStorage.getItem(this.name+this.salt));for(x=0;x<this.saveVars.length;x++)saveVar=this.saveVars[x],val=t[saveVar],console.log(saveVar+": "+val+": "+this.checkExists(val)),this.checkExists(val)&&this.setObjValByPath(game,val,this.saveVars[x]);game.research.display(),"user"==e&&notify.pop("success","Save-game successfully loaded!"),"silent"!==e&&log("Savegame loaded.")}},eventListenerSave:function(){game.save.save()},softResetSave:function(){var e=new Object;for(game.actions.totalReputationMultiplier=1,game.actions.totalRewardMultiplier=1,game.actions.totalTimeMultiplier=1,game.options.countReset+=1,game.collections.prepareSoftReset(),y=0;y<this.softResetSaveVars.length;y++)e[this.softResetSaveVars[y]]=this.getObjValByPath(game,this.softResetSaveVars[y]);localStorage.removeItem(game.save.name+game.save.salt),localStorage.setItem(this.name+this.salt,JSON.stringify(e))},reset:function(e,t){var o=this.save.saveInterval;$("#options-reset").html("Really?"),$("#options-yes, #options-no").show(),$("#options-reset").addClass("really"),e&&(window.clearInterval(o),window.removeEventListener("beforeunload",game.save.eventListenerSave,!1),localStorage.removeItem(this.name+this.salt),window.history.pushState("","","/#/"),window.location.reload()),t&&($("#options-reset").html("Hard-reset"),$("#options-yes, #options-no").hide(),$("#options-reset").removeClass("really"))},devReset:function(){var e=this.save.saveInterval;window.clearInterval(e),window.removeEventListener("beforeunload",game.save.eventListenerSave,!1),localStorage.removeItem(this.name+this.salt),window.history.pushState("","","/#/"),window.location.reload()},setInt:function(){this.saveInterval=window.setInterval(function(){game.save.save()},1e3),log("Save interval set - ID "+this.saveInterval)},removeInt:function(){var e=this.saveInterval;window.clearInterval(e),log("Save interval removed.")},init:function(){this.setInt(),window.game.save=this,window.addEventListener("beforeunload",game.save.eventListenerSave,!1),log("Save init.")}};return e.init()});